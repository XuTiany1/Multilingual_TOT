USER_CHAT_TEMPLATE = "<start_of_turn>пользователь\n{prompt}<end_of_turn><eos>\n"
MODEL_CHAT_TEMPLATE = "<start_of_turn>модель\n"

# standard prompt
standard_prompt = USER_CHAT_TEMPLATE.format(
    prompt="Ответьте на следующий математический вопрос. Введите только окончательный ответ в виде числа и ничего больше.\n"
) + "{question}\nОтвет: " + MODEL_CHAT_TEMPLATE

# cot prompt
cot_prompt = USER_CHAT_TEMPLATE.format(
    prompt="Ответьте на следующий математический вопрос. "
           "Думайте шаг за шагом и записывайте свой процесс рассуждений ниже. "
           "Последняя строка должна иметь форму 'Ответ: xxx', где xxx — это число.\n"
) + "Вопрос: {question}\nПошаговый ответ:\n" + MODEL_CHAT_TEMPLATE

# propose_prompt
propose_prompt = USER_CHAT_TEMPLATE.format(
    prompt="Представьте, что вы состоите из {n} независимых математиков, говорящих на {lang}, "
           "каждый из которых имеет уникальный взгляд на решение многошаговой математической задачи.\n\n"
           "Каждый математик предложит конкретный шаг для решения задачи. "
           "Шаг должен включать:\n"
           "- **Краткое объяснение**, почему этот шаг необходим и как он помогает решить задачу.\n"
           "- **Четкое уравнение** или вычисление, реализующее этот шаг.\n"
           "- Краткое указание на следующий логический шаг.\n\n"
           "Каждый математик должен начинать свой ответ с 'Мысль i: ', где 'i' — это 1, 2, ... {n}.\n\n"
           "Ответы должны быть написаны **в одной строке** в следующем формате:\n\n"
           "Математическое выражение заканчивается вычисленным значением.\n\n"
           "'Мысль i: Предложение. Уравнение: [Математическое выражение]. Следующий шаг: Дальнейшее действие.'\n\n"
           "Каждый математик должен подходить к задаче независимо, рассматривая различные методы или разложения.\n\n"
           "Если это первый шаг, каждый математик самостоятельно решит, с чего лучше начать.\n"
           "Если есть предыдущий контекст, они будут основываться на текущем процессе рассуждений, обеспечивая продвижение вперёд.\n\n"
           "Этот процесс продолжается до получения окончательного ответа, при этом каждый шаг уточняет решение.\n\n"
) + "---\n" \
    "Вопрос: {question}\n\n" \
    "Контекст (предыдущий ход рассуждений, если имеется):\n{current_thought_process}\n\n" \
    "Конкретные шаги, предложенные тремя математиками:\n" \
    + MODEL_CHAT_TEMPLATE

# value_prompt
value_prompt = USER_CHAT_TEMPLATE.format(
    prompt="Оцените, способствует ли данный шаг рассуждения решению проблемы. "
           "Ответьте только 'Оценка: верно', 'Оценка: вероятно' или 'Оценка: невозможно'. "
           "Не включайте объяснения или дополнительный текст.\n\n"
           "Выберите одно из следующих суждений:\n"
           "- верно: Шаг корректный и логически ведёт к решению.\n"
           "- вероятно: Шаг выглядит правдоподобным, но может потребовать уточнения или содержит недостаток деталей.\n"
           "- невозможно: Шаг неверный, не имеет отношения к задаче или противоречит известным фактам.\n\n"
           "---\n"
           "Вопрос: Поезд отправляется со станции A с 50 пассажирами. На следующей остановке 15 пассажиров выходят, "
           "а 30 новых пассажиров заходят. Сколько пассажиров теперь в поезде?\n\n"
           "Предложенный следующий шаг: Вычислить чистое изменение: -15 + 30.\nОценка: верно\n\n"
           "Предложенный следующий шаг: Представить ситуацию в виде уравнения: 50 - 15 + 30 = x.\nОценка: верно\n\n"
           "Предложенный следующий шаг: Предположить, что поезд потерял 20 пассажиров на следующей остановке и проверить, совпадает ли итоговое число.\nОценка: невозможно\n\n"
           "Предложенный следующий шаг: Представить ситуацию в процентах: (50 - 15) / 50.\nОценка: невозможно\n\n"
           "Предложенный следующий шаг: Рассмотреть вариант, при котором количество пассажиров удваивается на каждой остановке.\nОценка: невозможно\n\n"
           "Предложенный следующий шаг: Перевернуть ход рассуждений, предполагая, что конечное количество пассажиров равно x, и работать в обратном порядке.\nОценка: верно\n\n"
           "---\n"
           "Вопрос: В серверной комнате было девять компьютеров. Каждый день с понедельника по четверг устанавливали ещё пять компьютеров. "
           "Сколько компьютеров теперь в серверной комнате?\n\n"
           "Предложенный следующий шаг: Вычислить общее количество добавленных компьютеров: 5 × 4.\nОценка: верно\n\n"
           "Предложенный следующий шаг: Представить изменение в виде арифметической прогрессии: 9 + (5 × n), где n — количество дней.\nОценка: верно\n\n"
           "Предложенный следующий шаг: Рассмотреть вариант, при котором компьютеры убирали, а не добавляли: 9 - (5 × 4).\nОценка: невозможно\n\n"
           "Предложенный следующий шаг: Представить задачу в виде соотношения: (9 / 5) × 4.\nОценка: невозможно\n\n"
           "Предложенный следующий шаг: Предположить, что компьютеры добавляются по экспоненциальному закону, а не линейно.\nОценка: невозможно\n\n"
           "Предложенный следующий шаг: Проверить, даёт ли обратный расчёт всё ещё 9 начальных компьютеров.\nОценка: верно\n\n"
) + "---\n" \
    "{question}\n\n" \
    "Предложенный следующий шаг: {curr_candidate}\n\n" \
    "Оценка:" \
    + MODEL_CHAT_TEMPLATE

# Force output prompt
force_output_prompt = USER_CHAT_TEMPLATE.format(
    prompt="Исходя из приведённого ниже контекста, сформулируйте окончательный ответ на задачу.\n\n"
           "Строго соблюдайте следующие правила:\n"
           "- Запишите уравнения шаг за шагом, логически объясняя каждое вычисление.\n"
           "- Основывайтесь на предоставленном контексте, следя за тем, чтобы каждый шаг логически вытекал из предыдущего.\n"
           "- Не повторяйте уже указанные шаги.\n"
           "- В последней строке укажите окончательный ответ только в виде числа без дополнительного текста.\n\n"
           "Контекст (предыдущий процесс рассуждений, если есть):\n"
           "{context}\n\n"
) + "---\n" \
    "Вопрос: {question}\n\n" \
    "Решение:\n" \
    "Шаг 1: " \
    + MODEL_CHAT_TEMPLATE

# Choose final answer
final_judge_prompt = USER_CHAT_TEMPLATE.format(
    prompt="Вы — математический судья, который должен определить окончательный ответ на задачу.\n\n"
           "Сначала внимательно проанализируйте условие задачи. Затем тщательно изучите предложенные ниже ответы кандидатов.\n"
           "Сравните логические рассуждения в каждом ответе и выберите наиболее точный итоговый результат.\n\n"
           "Следуйте этим правилам:\n"
           "- Логически анализируйте задачу, прежде чем принимать решение.\n"
           "- Если существует несколько правильных ответов, выберите наиболее обоснованный.\n"
           "- Если в ответе есть несоответствия или пропущенные шаги, не учитывайте его.\n"
           "- Ваш окончательный ответ должен содержать только число без пояснений или дополнительного текста.\n\n"
           "---\n"
           "Условие задачи:\n"
           "{question}\n\n"
           "Ответы кандидатов:\n"
           "{candidate_answers}\n\n"
           "---\n"
           "Окончательный ответ: "
) + MODEL_CHAT_TEMPLATE