USER_CHAT_TEMPLATE = "<start_of_turn>用户\n{prompt}<end_of_turn><eos>\n"
MODEL_CHAT_TEMPLATE = "<start_of_turn>模型\n"

# standard prompt
standard_prompt = USER_CHAT_TEMPLATE.format(
    prompt="回答以下数学问题。只输入最终答案的数字，不要包含任何其他内容。\n"
) + "{question}\n答案: " + MODEL_CHAT_TEMPLATE

# cot prompt
cot_prompt = USER_CHAT_TEMPLATE.format(
    prompt="回答以下数学问题。"
           "请逐步思考并记录您的推理过程。"
           "最后一行的格式应为“答案是 xxx”，其中 xxx 是一个数字。\n"
) + "问题: {question}\n逐步解答:\n" + MODEL_CHAT_TEMPLATE

# propose_prompt
propose_prompt = USER_CHAT_TEMPLATE.format(
    prompt="想象您由 {n} 位独立的数学家组成，他们使用 {lang} 交流，"
           "每位数学家都有独特的视角来解决多步骤数学问题。\n\n"
           "在给出推理过程之前，每位数学家应以 "
           "“数学家 i: ” 开头，其中 “i” 可以是 1、2 或 3。\n\n"
           "基于给定的问题和当前的推理过程，每位数学家将独立"
           "提出一个独特、创新且有效的下一步来解决问题。"
           "每个步骤应采用不同的方法，利用不同的数学技巧、问题拆解方式，"
           "或其他替代表示方法。\n\n"
           "每位数学家应清晰简洁地解释他们的思考过程，然后提出下一步。"
           "他们只会添加他们的第一步，允许后续讨论和优化。\n\n"
           "如果不存在先前的上下文，则这将标志着思考过程的开始，数学家们将提出"
           "不同的解题起点。\n\n"
           "该过程将逐步继续，直到找到最终答案。\n\n"
) + "---\n" \
    "问题: {question}\n\n" \
    "上下文（若有先前的推理过程）:\n{current_thought_process}\n\n" \
    "可能的下一步列表（每一行代表一位数学家的视角）:\n" \
    + MODEL_CHAT_TEMPLATE

# value_prompt
value_prompt = USER_CHAT_TEMPLATE.format(
    prompt="评估给定的推理步骤是否对解决问题有意义的贡献。"
           "仅回答 ‘评估: 确定’、‘评估: 可能’ 或 ‘评估: 不可能’。"
           "不要包含解释或任何额外的文本。\n\n"
           "请选择以下判断之一:\n"
           "- 确定: 该步骤正确，并且是通向解决方案的逻辑进展。\n"
           "- 可能: 该步骤是合理的，但可能需要进一步完善或缺少关键信息。\n"
           "- 不可能: 该步骤错误、无关或与已知事实相矛盾。\n\n"
           "---\n"
           "问题: 一列火车从 A 站出发，车上有 50 名乘客。到达下一站时，15 名乘客下车，"
           "30 名新乘客上车。现在火车上有多少名乘客？\n\n"
           "建议的下一步: 计算净变化量：-15 + 30。\n评估: 确定\n\n"
           "建议的下一步: 以方程表达情况：50 - 15 + 30 = x。\n评估: 确定\n\n"
           "建议的下一步: 假设火车在下一站失去了 20 名乘客，并检查总数是否匹配。\n评估: 不可能\n\n"
           "建议的下一步: 以百分比表示关系：(50 - 15) / 50。\n评估: 不可能\n\n"
           "建议的下一步: 考虑在每一站都让乘客数量加倍。\n评估: 不可能\n\n"
           "建议的下一步: 逆向推理，假设最终乘客数为 x，并向后推算。\n评估: 确定\n\n"
           "---\n"
           "问题: 服务器机房最初有 9 台计算机。从周一到周四，每天增加 5 台计算机。"
           "现在服务器机房中共有多少台计算机？\n\n"
           "建议的下一步: 计算总共新增的计算机数量：5 × 4。\n评估: 确定\n\n"
           "建议的下一步: 以算术数列的形式表示变化：9 + (5 × n)，其中 n 是天数。\n评估: 确定\n\n"
           "建议的下一步: 假设计算机被移除而不是添加：9 - (5 × 4)。\n评估: 不可能\n\n"
           "建议的下一步: 将问题转换为比例计算：(9 / 5) × 4。\n评估: 不可能\n\n"
           "建议的下一步: 假设计算机的增长模式是指数增长，而不是线性增加。\n评估: 不可能\n\n"
           "建议的下一步: 反向计算是否仍然得到最初的 9 台计算机。\n评估: 确定\n\n"
) + "---\n" \
    "{question}\n\n" \
    "建议的下一步: {curr_candidate}\n\n" \
    "评估:" \
    + MODEL_CHAT_TEMPLATE

# Force output prompt
force_output_prompt = USER_CHAT_TEMPLATE.format(
    prompt="根据以下上下文，给出问题的最终答案。\n\n"
           "严格遵循以下规则:\n"
           "- 逐步写出方程式，并清晰地解释每一步计算。\n"
           "- 在提供的上下文基础上继续推理，确保每一步都是逻辑的延续。\n"
           "- 不要重复上下文中已经存在的步骤。\n"
           "- 最后一行只提供最终答案的数字，不包含任何其他文本。\n\n"
           "上下文（若有先前的推理过程）:\n"
           "{context}\n\n"
) + "---\n" \
    "问题: {question}\n\n" \
    "解答:\n" \
    "步骤 1: " \
    + MODEL_CHAT_TEMPLATE

# Choose final answer
final_judge_prompt = USER_CHAT_TEMPLATE.format(
    prompt="你是一名数学裁判，负责确定问题的最终答案。\n\n"
           "首先，仔细分析题目。然后，严格审查下面提供的候选答案。\n"
           "比较每个候选答案的推理过程，并确定最准确的最终结果。\n\n"
           "遵循以下规则:\n"
           "- 在做出决定之前，先进行逻辑推理。\n"
           "- 如果有多个正确答案，请选择推理最清晰的一个。\n"
           "- 如果候选答案存在逻辑错误或缺少关键步骤，则不予考虑。\n"
           "- 最终输出应为一个正确的数字，不附加任何解释或额外文本。\n\n"
           "---\n"
           "题目:\n"
           "{question}\n\n"
           "候选答案:\n"
           "{candidate_answers}\n\n"
           "---\n"
           "最终答案: "
) + MODEL_CHAT_TEMPLATE