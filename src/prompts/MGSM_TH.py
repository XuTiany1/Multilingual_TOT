USER_CHAT_TEMPLATE = "<start_of_turn>ผู้ใช้\n{prompt}<end_of_turn><eos>\n"
MODEL_CHAT_TEMPLATE = "<start_of_turn>โมเดล\n"

# standard prompt
standard_prompt = USER_CHAT_TEMPLATE.format(
    prompt="ตอบคำถามคณิตศาสตร์ต่อไปนี้ กรอกเฉพาะคำตอบสุดท้ายเป็นตัวเลขและไม่มีข้อความอื่น ๆ\n"
) + "{question}\nคำตอบ: " + MODEL_CHAT_TEMPLATE

# cot prompt
cot_prompt = USER_CHAT_TEMPLATE.format(
    prompt="ตอบคำถามคณิตศาสตร์ต่อไปนี้ "
           "คิดอย่างเป็นขั้นตอนและบันทึกกระบวนการคิดของคุณด้านล่าง "
           "บรรทัดสุดท้ายควรอยู่ในรูปแบบ 'คำตอบคือ xxx' โดยที่ xxx คือตัวเลข\n"
) + "คำถาม: {question}\nคำตอบแบบเป็นขั้นตอน:\n" + MODEL_CHAT_TEMPLATE

# propose_prompt
propose_prompt = USER_CHAT_TEMPLATE.format(
    prompt="ลองจินตนาการว่าคุณประกอบไปด้วยนักคณิตศาสตร์อิสระ {n} คนที่พูดภาษา {lang}, "
           "แต่ละคนมีมุมมองเฉพาะตัวเกี่ยวกับวิธีการแก้ปัญหาทางคณิตศาสตร์ที่มีหลายขั้นตอน\n\n"
           "นักคณิตศาสตร์แต่ละคนจะเสนอขั้นตอนที่เป็นรูปธรรมเพื่อแก้ปัญหา "
           "ขั้นตอนนั้นต้องประกอบไปด้วย:\n"
           "- **คำอธิบายอย่างกระชับ** ว่าทำไมขั้นตอนนี้จึงจำเป็นและช่วยแก้ปัญหาอย่างไร\n"
           "- **สมการที่ชัดเจน** หรือการคำนวณที่ใช้ดำเนินการตามขั้นตอนนี้\n"
           "- คำแนะนำสั้นๆ เกี่ยวกับขั้นตอนถัดไปที่มีเหตุผลทางตรรกะ\n\n"
           "นักคณิตศาสตร์แต่ละคนควรเริ่มต้นคำตอบของตนด้วย 'ความคิดที่ i: ' โดยที่ 'i' คือ 1, 2, ... {n}\n\n"
           "คำตอบต้องเขียน **ในบรรทัดเดียว** ตามรูปแบบดังนี้:\n\n"
           "นิพจน์ทางคณิตศาสตร์จะสิ้นสุดลงด้วยค่าที่คำนวณได้\n\n"
           "'ความคิดที่ i: ข้อเสนอแนะ สมการ: [นิพจน์ทางคณิตศาสตร์] ขั้นตอนถัดไป: การดำเนินการถัดไป'\n\n"
           "นักคณิตศาสตร์แต่ละคนควรเข้าหาปัญหาอย่างอิสระ โดยพิจารณาวิธีการหรือแนวทางที่แตกต่างกัน\n\n"
           "หากนี่เป็นขั้นตอนแรก นักคณิตศาสตร์แต่ละคนจะตัดสินใจด้วยตนเองเกี่ยวกับวิธีการเริ่มต้นที่ดีที่สุด\n"
           "หากมีบริบทก่อนหน้านี้ พวกเขาจะสร้างขึ้นจากกระบวนการคิดที่มีอยู่เพื่อให้แน่ใจว่ามีความก้าวหน้าไปข้างหน้า\n\n"
           "กระบวนการนี้จะดำเนินต่อไปจนกว่าจะได้คำตอบที่ชัดเจน โดยแต่ละขั้นตอนจะช่วยปรับปรุงวิธีแก้ปัญหา\n\n"
) + "---\n" \
    "คำถาม: {question}\n\n" \
    "บริบท (กระบวนการคิดก่อนหน้านี้ ถ้ามี):\n{current_thought_process}\n\n" \
    "ขั้นตอนที่เป็นรูปธรรมที่เสนอโดยนักคณิตศาสตร์สามคน:\n" \
    + MODEL_CHAT_TEMPLATE

# value_prompt
value_prompt = USER_CHAT_TEMPLATE.format(
    prompt="ประเมินว่าขั้นตอนการให้เหตุผลที่กำหนดมีส่วนช่วยแก้ปัญหาอย่างมีความหมายหรือไม่ "
           "ตอบกลับด้วย 'การประเมิน: แน่นอน' 'การประเมิน: น่าจะเป็นไปได้' หรือ 'การประเมิน: เป็นไปไม่ได้' "
           "อย่ารวมคำอธิบายหรือข้อความเพิ่มเติมใด ๆ\n\n"
           "เลือกหนึ่งในเกณฑ์ต่อไปนี้:\n"
           "- แน่นอน: ขั้นตอนถูกต้องและเป็นความก้าวหน้าทางตรรกะในการแก้ปัญหา\n"
           "- น่าจะเป็นไปได้: ขั้นตอนมีเหตุผล แต่ยังต้องมีการปรับปรุงเพิ่มเติมหรือขาดรายละเอียดสำคัญ\n"
           "- เป็นไปไม่ได้: ขั้นตอนไม่ถูกต้อง ไม่เกี่ยวข้อง หรือขัดแย้งกับข้อเท็จจริงที่ทราบ\n\n"
           "---\n"
           "คำถาม: รถไฟออกจากสถานี A พร้อมผู้โดยสาร 50 คน ที่ป้ายถัดไป ผู้โดยสาร 15 คนลงจากรถ "
           "และมีผู้โดยสารใหม่ขึ้นมา 30 คน ขณะนี้มีผู้โดยสารอยู่บนรถไฟกี่คน?\n\n"
           "ขั้นตอนถัดไปที่เสนอ: คำนวณการเปลี่ยนแปลงสุทธิ: -15 + 30\nการประเมิน: แน่นอน\n\n"
           "ขั้นตอนถัดไปที่เสนอ: แสดงสถานการณ์เป็นสมการ: 50 - 15 + 30 = x\nการประเมิน: แน่นอน\n\n"
           "ขั้นตอนถัดไปที่เสนอ: สมมติว่ารถไฟเสียผู้โดยสาร 20 คนที่ป้ายถัดไปและตรวจสอบว่าจำนวนทั้งหมดตรงกันหรือไม่\nการประเมิน: เป็นไปไม่ได้\n\n"
           "ขั้นตอนถัดไปที่เสนอ: แสดงความสัมพันธ์เป็นเปอร์เซ็นต์: (50 - 15) / 50\nการประเมิน: เป็นไปไม่ได้\n\n"
           "ขั้นตอนถัดไปที่เสนอ: พิจารณาการเพิ่มจำนวนผู้โดยสารเป็นสองเท่าทุกป้าย\nการประเมิน: เป็นไปไม่ได้\n\n"
           "ขั้นตอนถัดไปที่เสนอ: สมมติว่าจำนวนสุดท้ายคือ x แล้วทำย้อนกลับ\nการประเมิน: แน่นอน\n\n"
) + "---\n" \
    "{question}\n\n" \
    "ขั้นตอนถัดไปที่เสนอ: {curr_candidate}\n\n" \
    "การประเมิน:" \
    + MODEL_CHAT_TEMPLATE

# Force output prompt
force_output_prompt = USER_CHAT_TEMPLATE.format(
    prompt="จากบริบททั้งหมดด้านล่าง กำหนดคำตอบสุดท้ายของปัญหา\n\n"
           "ปฏิบัติตามกฎเหล่านี้อย่างเคร่งครัด:\n"
           "- เขียนสมการทีละขั้นตอน โดยอธิบายการคำนวณแต่ละขั้นตอนอย่างมีเหตุผล\n"
           "- ใช้บริบทที่ให้ไว้เพื่อให้แน่ใจว่าทุกขั้นตอนเป็นการดำเนินการต่อที่มีเหตุผล\n"
           "- อย่าทำซ้ำขั้นตอนที่มีอยู่แล้วในบริบท\n"
           "- บรรทัดสุดท้ายควรให้คำตอบสุดท้ายเป็นตัวเลขเท่านั้น และไม่มีข้อความอื่น ๆ\n\n"
           "บริบท (กระบวนการคิดก่อนหน้า หากมี):\n"
           "{context}\n\n"
) + "---\n" \
    "คำถาม: {question}\n\n" \
    "วิธีแก้ปัญหา:\n" \
    "ขั้นตอนที่ 1: " \
    + MODEL_CHAT_TEMPLATE

# Choose final answer
final_judge_prompt = USER_CHAT_TEMPLATE.format(
    prompt="คุณเป็นผู้ตัดสินทางคณิตศาสตร์ที่มีหน้าที่กำหนดคำตอบสุดท้ายของปัญหา\n\n"
           "ก่อนอื่น วิเคราะห์คำถามอย่างรอบคอบ จากนั้นตรวจสอบคำตอบที่ผู้เข้าแข่งขันให้มาอย่างละเอียด\n"
           "เปรียบเทียบกระบวนการให้เหตุผลในแต่ละคำตอบ และพิจารณาว่าคำตอบใดที่แม่นยำที่สุด\n\n"
           "ปฏิบัติตามกฎเหล่านี้:\n"
           "- คิดวิเคราะห์ปัญหาอย่างมีเหตุผลก่อนตัดสินใจ\n"
           "- หากมีหลายคำตอบที่ถูกต้อง ให้เลือกคำตอบที่มีเหตุผลดีที่สุด\n"
           "- หากคำตอบมีความไม่สอดคล้องกันหรือขาดขั้นตอนที่สำคัญ อย่าใช้คำนั้น\n"
           "- คำตอบสุดท้ายควรเป็นตัวเลขที่ถูกต้องเพียงอย่างเดียว โดยไม่มีคำอธิบายหรือข้อความเพิ่มเติม\n\n"
           "---\n"
           "โจทย์:\n"
           "{question}\n\n"
           "คำตอบที่เสนอ:\n"
           "{candidate_answers}\n\n"
           "---\n"
           "คำตอบสุดท้าย: "
) + MODEL_CHAT_TEMPLATE